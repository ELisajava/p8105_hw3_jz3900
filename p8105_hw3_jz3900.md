p8105_hw3_jz3900
================
ELisajava
2024-10-15

# Load Necessary Libraries

``` r
library(tidyverse) 
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(ggplot2)
library(lubridate)
library(ggridges)
library(patchwork) #For combining plots
library(hexbin) #For hexbin plots
library(gt)
library(p8105.datasets)
```

# Configure Global Plot Settings

``` r
knitr::opts_chunk$set(
  fig.width = 10,
  fig.asp = 0.8,
  out.width = '90%'
)

## Setting color options globally
options(
  ggplot2.continuous.color = "magma",
  ggplot2.continuous.fill = "magma"
)

## Assigning scales for discrete color and fill
discrete_color_scale <- scale_color_viridis_d
discrete_fill_scale <- scale_fill_viridis_d
```

# Problem 1

- Write a short description of the dataset.
- Clean the data. Create separate variables for year, month, and day.
  Ensure observations for temperature, precipitation, and snowfall are
  given in reasonable units.
- Make a two-panel plot showing the average max temperature in January
  and in July in each station across years.
- Make a two-panel plot showing (i) tmax vs tmin for the full
  dataset; (ii) make a plot showing the distribution of snowfall values
  greater than 0 and less than 100 separately by year.

## Step 1: Import and describe the dataset

``` r
# Load the dataset
data("ny_noaa")

# Display the structure of the dataset
str(ny_noaa)
```

    ## tibble [2,595,176 × 7] (S3: tbl_df/tbl/data.frame)
    ##  $ id  : chr [1:2595176] "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" ...
    ##  $ date: Date[1:2595176], format: "2007-11-01" "2007-11-02" ...
    ##  $ prcp: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snow: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snwd: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ tmax: chr [1:2595176] NA NA NA NA ...
    ##  $ tmin: chr [1:2595176] NA NA NA NA ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   id = col_character(),
    ##   ..   date = col_date(format = ""),
    ##   ..   prcp = col_integer(),
    ##   ..   snow = col_integer(),
    ##   ..   snwd = col_integer(),
    ##   ..   tmax = col_character(),
    ##   ..   tmin = col_character()
    ##   .. )

``` r
# Display the dimensions of the dataset
dim(ny_noaa)
```

    ## [1] 2595176       7

``` r
# Summarize the dataset
summary(ny_noaa)
```

    ##       id                 date                 prcp               snow       
    ##  Length:2595176     Min.   :1981-01-01   Min.   :    0.00   Min.   :  -13   
    ##  Class :character   1st Qu.:1988-11-29   1st Qu.:    0.00   1st Qu.:    0   
    ##  Mode  :character   Median :1997-01-21   Median :    0.00   Median :    0   
    ##                     Mean   :1997-01-01   Mean   :   29.82   Mean   :    5   
    ##                     3rd Qu.:2005-09-01   3rd Qu.:   23.00   3rd Qu.:    0   
    ##                     Max.   :2010-12-31   Max.   :22860.00   Max.   :10160   
    ##                                          NA's   :145838     NA's   :381221  
    ##       snwd            tmax               tmin          
    ##  Min.   :   0.0   Length:2595176     Length:2595176    
    ##  1st Qu.:   0.0   Class :character   Class :character  
    ##  Median :   0.0   Mode  :character   Mode  :character  
    ##  Mean   :  37.3                                        
    ##  3rd Qu.:   0.0                                        
    ##  Max.   :9195.0                                        
    ##  NA's   :591786

### A short description of the dataset

- The ny_noaa dataset have 2595176 columns (observations) and 7 columns
  (variables).
- The variables includes:
  - id: Weather station identifier,
  - date: Date of the observation,
  - prcp: Precipitation (tenths of mm),
  - snow: Snowfall (mm),
  - snwd: Snow depth (mm),
  - tmax: Maximum temperature (tenths of degrees C),
  - tmin: Minimum temperature (tenths of degrees C).
- Information on statistics：
  - prcp: Mean: 29.82, Min: 0.00, Max: 22860.00;
  - snow: Mean: 5, Min: -13, Max: 10160;
  - snwd: Mean 37.3, Min: 0.0, Max: 9195.0.
- Note: Some variables contain missing values.

## Step 2: Missing data

``` r
# Caculate the missing data percentages
ny_noaa %>%
  summarise(
    missing_prcp = mean(is.na(prcp)) * 100,
    missing_snow = mean(is.na(snow)) * 100,
    missing_snwd = mean(is.na(snwd)) * 100,
    missing_tmax = mean(is.na(tmax)) * 100,
    missing_tmin = mean(is.na(tmin)) * 100
  )
```

    ## # A tibble: 1 × 5
    ##   missing_prcp missing_snow missing_snwd missing_tmax missing_tmin
    ##          <dbl>        <dbl>        <dbl>        <dbl>        <dbl>
    ## 1         5.62         14.7         22.8         43.7         43.7

### Description of missing data:

- Approximately 5.62% of the prcp values are missing,
- Approximately 14.68% of the snow values are missing,
- Approximately 22.80% of the snwd values are missing,
- Approximately 43.69% of the tmax values and 46.23% of the tmin values
  are missing. The proportion of missing data for both tmax and tmin is
  notably high.

## Step 3: Data cleaning

``` r
# Create separate variables for year, month, and day
ny_noaa = ny_noaa %>%
  mutate(
    year = year(date),
    month = month(date),
    day = day(date)
  )

# Convert `prcp`, `tmax`, and `tmin` to numeric format before unit conversion
ny_noaa = ny_noaa %>%
  mutate(
    prcp = as.numeric(prcp),
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin)
  )

# Adjust units for temperature and precipitation
ny_noaa = ny_noaa %>%
  mutate(
    prcp = prcp/10,  # Precipitation converts from tenths of mm to mm.
    tmax = tmax/10,  # Max temp converts from tenths of degrees Celsius to degrees Celsius.
    tmin = tmin/10   # Min temp converts from tenths of degrees Celsius to degrees Celsius.
  )
```

``` r
# Ensure logical consistency in temperature data (tmax data is higher than tmin data)
ny_noaa = ny_noaa %>%
  filter(tmax > tmin | is.na(tmax) | is.na(tmin))  

# Filter rows with missing values in key variables (snow, snwd, tmax, tmin, prcp)
ny_noaa = ny_noaa %>%
  filter(!(is.na(snow) & is.na(snwd) & is.na(tmax) & is.na(tmin) & is.na(prcp)))
head(ny_noaa)
```

    ## # A tibble: 6 × 10
    ##   id          date        prcp  snow  snwd  tmax  tmin  year month   day
    ##   <chr>       <date>     <dbl> <int> <int> <dbl> <dbl> <dbl> <dbl> <int>
    ## 1 US1NYAB0001 2007-11-17   0.3     3     0    NA    NA  2007    11    17
    ## 2 US1NYAB0001 2007-11-18   0       0    NA    NA    NA  2007    11    18
    ## 3 US1NYAB0001 2007-11-19   0       0     0    NA    NA  2007    11    19
    ## 4 US1NYAB0001 2007-11-20   2.5     0     0    NA    NA  2007    11    20
    ## 5 US1NYAB0001 2007-11-21   7.1     0     0    NA    NA  2007    11    21
    ## 6 US1NYAB0001 2007-11-22   0.8     0    NA    NA    NA  2007    11    22

### Q 1: For snowfall, what are the most commonly observed values? Why?

``` r
# Count the occurrences of each snowfall value
snow_counts = ny_noaa %>%
  count(snow) %>%
  arrange(desc(n))

# Display the most common snowfall values
head(snow_counts)
```

    ## # A tibble: 6 × 2
    ##    snow       n
    ##   <int>   <int>
    ## 1     0 2007240
    ## 2    NA  308654
    ## 3    25   30981
    ## 4    13   23082
    ## 5    51   18253
    ## 6    76   10159

``` r
str(ny_noaa)
```

    ## tibble [2,521,165 × 10] (S3: tbl_df/tbl/data.frame)
    ##  $ id   : chr [1:2521165] "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" ...
    ##  $ date : Date[1:2521165], format: "2007-11-17" "2007-11-18" ...
    ##  $ prcp : num [1:2521165] 0.3 0 0 2.5 7.1 0.8 0.8 0.3 0 0.8 ...
    ##  $ snow : int [1:2521165] 3 0 0 0 0 0 0 3 0 5 ...
    ##  $ snwd : int [1:2521165] 0 NA 0 0 0 NA NA 0 NA NA ...
    ##  $ tmax : num [1:2521165] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ tmin : num [1:2521165] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ year : num [1:2521165] 2007 2007 2007 2007 2007 ...
    ##  $ month: num [1:2521165] 11 11 11 11 11 11 11 11 11 11 ...
    ##  $ day  : int [1:2521165] 17 18 19 20 21 22 23 24 25 26 ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   id = col_character(),
    ##   ..   date = col_date(format = ""),
    ##   ..   prcp = col_integer(),
    ##   ..   snow = col_integer(),
    ##   ..   snwd = col_integer(),
    ##   ..   tmax = col_character(),
    ##   ..   tmin = col_character()
    ##   .. )

- Answer of Q 1:
  - The most commonly observed value for snowfall is 0 mm, with
    2,008,508 occurrences.
  - A possible reason for this is that snowfall does not occur daily and
    is primarily concentrated in the winter months.

## Step 4: Data Visualization:

## Part 1: Average Max Temperature in January and July Across Years

``` r
# Filter data for January and July
temp_jan_jul = ny_noaa %>%
  filter(month %in% c(1, 7)) %>%
  group_by(id, year, month) %>%
  summarise(
    avg_tmax = mean(tmax, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(month = case_when(
    month == 1 ~ "January",
    month == 7 ~ "July"
  ))

# Visualization for January
plot_jan <- ggplot(subset(temp_jan_jul, month == "January"), 
                   aes(x = year, y = avg_tmax, group = id, col = id)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Average Max Temperature in January",
    x = "Year",
    y = "Average Max Temperature (°C)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5,size=15)
)

# Visualization for July
plot_jul <- ggplot(subset(temp_jan_jul, month == "July"), 
                   aes(x = year, y = avg_tmax, group = id, col = id)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Average Max Temperature in July",
    x = "Year",
    y = "Average Max Temperature (°C)"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = 0.5,size=15)
)

# Combine the two plots using patchwork library
combined_plot <- plot_jan / plot_jul
combined_plot + plot_layout(heights = c(1, 1))
```

    ## Warning: Removed 2923 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

    ## Warning: Removed 3047 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-8-1.png" width="90%" />

### Q 2: Is there any observable / interpretable structure? Any outliers?

- Structure:

  - Temperature Separation: January temperatures are colder, ranging
    approximately from -10°C to 10°C, while July temperatures are much
    warmer, around 20°C to 35°C.
  - Variation: January shows more variation across years, with
    temperatures fluctuating widely. July has a more stable temperature
    range, with most values clustered between 25°C and 30°C.

- Trend:

  - A slight upward trend in January’s temperatures is visible over
    time, while July’s temperatures remain largely stable.

- Outliers:

  - January: A few years have unusually cold temperatures, dipping below
    -10°C, which stand out as extreme values.
  - July: There are some outliers below 20°C, indicating unusually cool
    summers in certain years.

## Part 2: tmax vs tmin Plot and Snowfall Distribution

### tmax vs tmin Plot

``` r
# Hexbin plot for tmax vs tmin
p_temp = ggplot(ny_noaa, aes(x = tmin, y = tmax)) +
  geom_hex(bins = 50) +
  labs(
    title = "Relationship Between Minimum and Maximum Temperatures",
    x = "Minimum Temperature (°C)",
    y = "Maximum Temperature (°C)"
  ) +
  theme_minimal()+
  theme(
     plot.title = element_text(hjust = 0.5,size=15)
  )
```

### Snowfall Distribution by Year

``` r
### Snowfall Distribution by Year
# Filter snowfall data
snowfall_filtered = ny_noaa %>%
  filter(snow > 0, snow < 100)

# Plot snowfall distribution by year using boxplots
p_snow = ggplot(snowfall_filtered, aes(x = factor(year), y = snow)) +
  geom_boxplot(outlier.size = 0.5, alpha = 0.7) +
  labs(
    title = "Distribution of Snowfall by Year",
    x = "Year",
    y = "Snowfall (mm)"
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1),
    panel.grid.major.x = element_blank(),
    plot.title = element_text(hjust = 0.5,size=15) 
  )

# Fix: ensure correct color scale for hex plot
p_temp = p_temp + scale_fill_viridis_c(option = "magma")

# Combine the temperature and snowfall plots
p_temp + p_snow + plot_layout(ncol = 1)
```

    ## Warning: Removed 1063998 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-10-1.png" width="90%" />

# Problem 2

- Load, tidy, merge, and organize the data sets: (1) include all
  originally observed variables); (2) exclude participants less than 21
  years of age; (3) exclude those with missing demographic data; (4)
  encode data with reasonable variable classes (i.e. not numeric, and
  using factors with the ordering of tables and plots in mind).

- Produce a reader-friendly table for the number of men and women in
  each education category, and create a visualization of the age
  distributions for men and women in each education category. Comment on
  these items.

- Using the tidied dataset, aggregate across minutes to create a total
  activity variable for each participant. Plot these total activities
  (y-axis) against age (x-axis); your plot should compare men to women
  and have separate panels for each education level. Include a trend
  line or a smooth to illustrate differences. Comment on your plot.

- Make a three-panel plot that shows the 24-hour activity time courses
  for each education level and use color to indicate sex. Describe in
  words any patterns or conclusions you can make based on this graph;
  including smooth trends may help identify differences.

## Step 1: Load and Organize the Data Sets

``` r
# Load the data sets
demographics <- read_csv(file = "./dataset/nhanes_covar.csv", skip = 4)
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accelerometer <- read_csv(file = "./dataset/nhanes_accel.csv")
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# Check structure and summary of both data sets
glimpse(demographics)
```

    ## Rows: 250
    ## Columns: 5
    ## $ SEQN      <dbl> 62161, 62164, 62169, 62174, 62177, 62178, 62180, 62184, 6218…
    ## $ sex       <dbl> 1, 2, 1, 1, 1, 1, 1, 1, 2, 2, 1, 1, 2, 1, 1, 1, 2, 1, 2, 2, …
    ## $ age       <dbl> 22, 44, 21, 80, 51, 80, 35, 26, 17, 30, 70, 17, 16, 57, 36, …
    ## $ BMI       <dbl> 23.3, 23.2, 20.1, 33.9, 20.1, 28.5, 27.9, 22.1, 22.9, 22.4, …
    ## $ education <dbl> 2, 3, 2, 3, 2, 2, 3, 2, NA, 3, 2, NA, NA, 3, 1, 3, 3, 3, 1, …

``` r
accelerometer %>% select(1:6) %>% glimpse()
```

    ## Rows: 250
    ## Columns: 6
    ## $ SEQN <dbl> 62161, 62164, 62169, 62174, 62177, 62178, 62180, 62184, 62186, 62…
    ## $ min1 <dbl> 1.1060000, 1.9245714, 5.8468571, 5.4210000, 6.1432857, 0.1665714,…
    ## $ min2 <dbl> 3.11516667, 1.66942857, 5.17771429, 3.48216667, 8.05742857, 0.428…
    ## $ min3 <dbl> 1.46750000, 2.37600000, 4.76285714, 3.71733333, 9.99028571, 0.131…
    ## $ min4 <dbl> 0.9376667, 0.9345714, 6.4820000, 3.8083333, 6.5981429, 1.2022857,…
    ## $ min5 <dbl> 1.59866667, 2.59314286, 6.85357143, 6.85466667, 4.57100000, 0.079…

``` r
# Filter out participants younger than 21 years old and remove missing data in the demographic dataset
demographics <- demographics %>%
  filter(age >= 21) %>%
  drop_na()

# Merge the two datasets by SEQN
data <- inner_join(accelerometer, demographics, by = "SEQN") %>%
  pivot_longer(
    cols = starts_with("min"),
    names_to = "minute_interval",
    values_to = "MIMS"
  ) %>%
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("male", "female")),
    education = factor(education, levels = c(1, 2, 3), labels = c("Less than high school", "High school equivalent", "More than high school")),
    minute_interval = str_replace(minute_interval, "min", "")
  )
```

- I merged the datasets and excluded participants who were younger than
  21 years old or had missing demographic information. I transformed the
  variables for sex and education into categorical factors, assigning
  the labels “male” and “female” for sex, and “Less than high school,”
  “High school equivalent,” and “More than high school” for education.
  Additionally, I stripped the “min” strings from the minute_interval
  variable.

## Step 2: Creat a readable table

``` r
# Select distinct participant data based on SEQN, sex, and education
participant_data <- data %>%
  select(SEQN, sex, education) %>%
  distinct()

# Summarize participant count by sex and education
num_data <- participant_data %>%
  group_by(sex, education) %>%
  summarise(number = n(), .groups = "drop")

# Reshape the data for better readability
readable_data <- num_data %>%
  pivot_wider(
    names_from = education,
    values_from = number
  )

# Create a more readable table
readable_data%>%
  gt() %>%
  tab_header(title = "Number of Men and Women in Each Education Category")
```

<div id="hjkygxoosm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hjkygxoosm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
&#10;#hjkygxoosm thead, #hjkygxoosm tbody, #hjkygxoosm tfoot, #hjkygxoosm tr, #hjkygxoosm td, #hjkygxoosm th {
  border-style: none;
}
&#10;#hjkygxoosm p {
  margin: 0;
  padding: 0;
}
&#10;#hjkygxoosm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}
&#10;#hjkygxoosm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}
&#10;#hjkygxoosm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}
&#10;#hjkygxoosm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}
&#10;#hjkygxoosm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}
&#10;#hjkygxoosm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}
&#10;#hjkygxoosm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}
&#10;#hjkygxoosm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}
&#10;#hjkygxoosm .gt_spanner_row {
  border-bottom-style: hidden;
}
&#10;#hjkygxoosm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}
&#10;#hjkygxoosm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}
&#10;#hjkygxoosm .gt_from_md > :first-child {
  margin-top: 0;
}
&#10;#hjkygxoosm .gt_from_md > :last-child {
  margin-bottom: 0;
}
&#10;#hjkygxoosm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}
&#10;#hjkygxoosm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#hjkygxoosm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}
&#10;#hjkygxoosm .gt_row_group_first td {
  border-top-width: 2px;
}
&#10;#hjkygxoosm .gt_row_group_first th {
  border-top-width: 2px;
}
&#10;#hjkygxoosm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#hjkygxoosm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_first_summary_row.thick {
  border-top-width: 2px;
}
&#10;#hjkygxoosm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#hjkygxoosm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}
&#10;#hjkygxoosm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#hjkygxoosm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#hjkygxoosm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#hjkygxoosm .gt_left {
  text-align: left;
}
&#10;#hjkygxoosm .gt_center {
  text-align: center;
}
&#10;#hjkygxoosm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}
&#10;#hjkygxoosm .gt_font_normal {
  font-weight: normal;
}
&#10;#hjkygxoosm .gt_font_bold {
  font-weight: bold;
}
&#10;#hjkygxoosm .gt_font_italic {
  font-style: italic;
}
&#10;#hjkygxoosm .gt_super {
  font-size: 65%;
}
&#10;#hjkygxoosm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}
&#10;#hjkygxoosm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}
&#10;#hjkygxoosm .gt_indent_1 {
  text-indent: 5px;
}
&#10;#hjkygxoosm .gt_indent_2 {
  text-indent: 10px;
}
&#10;#hjkygxoosm .gt_indent_3 {
  text-indent: 15px;
}
&#10;#hjkygxoosm .gt_indent_4 {
  text-indent: 20px;
}
&#10;#hjkygxoosm .gt_indent_5 {
  text-indent: 25px;
}
&#10;#hjkygxoosm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}
&#10;#hjkygxoosm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style>Number of Men and Women in Each Education Category</td>
    </tr>
    &#10;    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="sex">sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Less-than-high-school">Less than high school</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="High-school-equivalent">High school equivalent</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="More-than-high-school">More than high school</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="sex" class="gt_row gt_center">male</td>
<td headers="Less than high school" class="gt_row gt_right">27</td>
<td headers="High school equivalent" class="gt_row gt_right">35</td>
<td headers="More than high school" class="gt_row gt_right">56</td></tr>
    <tr><td headers="sex" class="gt_row gt_center">female</td>
<td headers="Less than high school" class="gt_row gt_right">28</td>
<td headers="High school equivalent" class="gt_row gt_right">23</td>
<td headers="More than high school" class="gt_row gt_right">59</td></tr>
  </tbody>
  &#10;  
</table>
</div>

``` r
# Create a bar plot of participant counts
p1 <- ggplot(num_data, aes(x = education, y = number, fill = sex)) +
  geom_col(position = position_dodge2()) +
  geom_text(aes(label = number), position = position_dodge2(width = 0.9), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Number of Participants by Sex and Education", x = "Education Level", y = "Count of Participants") +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.75),
        plot.title = element_text(hjust = 0.5,size=15)
        )

# Create a proportional bar plot by education level and sex
p2 <- ggplot(participant_data, aes(x = education, fill = sex)) +
  geom_bar(position = "fill") +
  scale_y_continuous(labels = scales::percent_format()) +
  theme_minimal() +
  labs(title = "Proportion of Sex within Education Level", x = "Education Level", y = "Proportion") +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.75),
        plot.title = element_text(hjust = 0.5,size=15)
        )

# Combine the two plots side by side
combined_plot <- p1 + p2 + plot_layout(ncol = 2)
combined_plot
```

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-12-1.png" width="90%" />

- I started by generating a table that shows the count of men and women
  across various education levels. To enhance readability, I reformatted
  the table using the `pivot_wider` function. The resulting plot
  indicates that individuals with more than a high school education make
  up the largest proportion for both sexes. Moreover, there are fewer
  men than women in the “Less than high school” category, while more men
  than women fall into the “High school equivalent” category.

## Step 3: Aggregate Total Activity

``` r
# Summarize total activity for each participant
total_activity_data <- data %>%
  group_by(SEQN, sex, age, education) %>%
  summarise(total_activity = sum(MIMS, na.rm = TRUE), .groups = "drop")

# Plot total activity vs age by sex, with separate panels for education levels
total_activity_plot <- ggplot(total_activity_data, aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE) +
  facet_wrap(~ education) +
  labs(title = "Total Activity vs Age by Sex and Education Level", x = "Age", y = "Total Activity (MIMS)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 30, hjust = 0.75),
        plot.title = element_text(hjust = 0.5,size=15)  
  )

# Display the plot
print(total_activity_plot)
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-13-1.png" width="90%" />

- In the graph, male data is shown in red and female data in blue.
  Overall, women’s total activity levels are higher than men’s across
  all ages in the two right-hand graphs. In the left graph, women’s
  total activity exceeds men’s until around age 40, after which it falls
  below men’s. In terms of overall trends, total activity decreases for
  all education levels after around age 60. Those with less than a high
  school education reach their highest activity levels around age 20,
  while individuals with a high school equivalent education peak around
  age 40. People with more than a high school education maintain
  relatively high activity levels up to age 60.

## Step 4: Create a three-panel plot

``` r
# Function to generate activity plots with refinements
generate_activity_plot <- function(education_category, plot_title) {
  activity_data <- data %>%
    filter(education == education_category) %>%
    mutate(hour_interval = as.numeric(minute_interval) %/% 60) %>%  # Grouping by hour
    group_by(hour_interval, sex) %>%  # Group by hour and sex
    summarise(mean_activity_per_hour = mean(MIMS, na.rm = TRUE), .groups = "drop")
  
  ggplot(activity_data, aes(x = hour_interval, y = mean_activity_per_hour, color = sex)) +
    geom_point(alpha = 0.5) +
    geom_smooth(method = "loess", se = FALSE) +
    theme_minimal() +
    theme(
      legend.position = "bottom",
      plot.title = element_text(hjust = 0.5,size=15)  # Centering the title
    ) +
    labs(
      title = plot_title,
      x = "Hour Interval",
      y = "Mean MIMS per Hour"
    )
}

# Generate plots for different education levels
p1 <- generate_activity_plot("Less than high school", "Less than High School")
p2 <- generate_activity_plot("High school equivalent", "High School Equivalent")
p3 <- generate_activity_plot("More than high school", "More than High School")

# Combine the plots
p1 + p2 + p3
```

    ## `geom_smooth()` using formula = 'y ~ x'
    ## `geom_smooth()` using formula = 'y ~ x'
    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-14-1.png" width="90%" />

- The plot shows clear differences in daily physical activity patterns
  by education level and gender. Activity generally peaks around midday
  for all groups, likely due to routines like commuting, work, or
  exercise. Those with higher education levels maintain more structured
  and higher activity throughout the day, suggesting better health
  awareness or access to physical activities. Women tend to have higher
  activity levels than men, especially in the “High School Equivalent”
  and “More than High School” groups, indicating more involvement in
  organized activities. In contrast, those with less than a high school
  education show lower activity peaks, possibly due to more sedentary
  behavior. Activity levels decrease sharply in the evening, likely
  reflecting rest periods. These insights highlight the need for
  strategies to promote physical activity, especially among those with
  lower education levels and in the evening to reduce sedentary time.

# Problem 3

## Step 1: Import and organize the dataset

### Import four datasets

``` r
Jan_2020_Citi <- read_csv("./dataset/citibike/Jan\ 2020\ Citi.csv", show_col_types = FALSE)
Jan_2024_Citi <- read_csv("./dataset/citibike/Jan\ 2024\ Citi.csv", show_col_types = FALSE)
July_2020_Citi <- read_csv("./dataset/citibike/July\ 2020\ Citi.csv", show_col_types = FALSE)
July_2024_Citi <- read_csv("./dataset/citibike/July\ 2024\ Citi.csv", show_col_types = FALSE) 
```

### Clean and tidy these data

``` r
# Add year, month and dataset source columns to each dataset 
Jan_2020_Citi <- Jan_2020_Citi %>% 
  mutate(year = 2020, month = "January", dataset = "Jan_2020_Citi")
Jan_2024_Citi <- Jan_2024_Citi %>% 
  mutate(year = 2024, month = "January", dataset = "Jan_2024_Citi")
July_2020_Citi <- July_2020_Citi %>% 
  mutate(year = 2020, month = "July", dataset = "July_2020_Citi")
July_2024_Citi <- July_2024_Citi %>% 
  mutate(year = 2024, month = "July", dataset = "July_2024_Citi")

# Merge four datasets 
citi_data <- bind_rows(Jan_2020_Citi, Jan_2024_Citi,July_2020_Citi, July_2024_Citi) 

# Display the merged data
glimpse(citi_data)
```

    ## Rows: 99,485
    ## Columns: 10
    ## $ ride_id            <chr> "4BE06CB33B037044", "26886E034974493B", "24DC56060E…
    ## $ rideable_type      <chr> "classic_bike", "classic_bike", "classic_bike", "cl…
    ## $ weekdays           <chr> "Tuesday", "Wednesday", "Friday", "Sunday", "Friday…
    ## $ duration           <dbl> 15.333267, 5.309467, 9.691800, 6.996183, 2.849500, …
    ## $ start_station_name <chr> "Columbus Ave & W 95 St", "2 Ave & E 96 St", "Colum…
    ## $ end_station_name   <chr> "E 53 St & Madison Ave", "1 Ave & E 110 St", "Grand…
    ## $ member_casual      <chr> "member", "member", "member", "member", "member", "…
    ## $ year               <dbl> 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 202…
    ## $ month              <chr> "January", "January", "January", "January", "Januar…
    ## $ dataset            <chr> "Jan_2020_Citi", "Jan_2020_Citi", "Jan_2020_Citi", …

``` r
# Check missing data
colSums(is.na(citi_data))
```

    ##            ride_id      rideable_type           weekdays           duration 
    ##                  0                  0                  0                  0 
    ## start_station_name   end_station_name      member_casual               year 
    ##                 43                207                  0                  0 
    ##              month            dataset 
    ##                  0                  0

- I merged the four datasets into a single data frame and checked for
  missing values. The dataset is generally complete, with the exception
  of some missing station names. These missing values may be due to
  technical issues, such as GPS errors, or data entry problems. To
  address this, I label the missing station names as ‘Unknown’ in next
  code.

``` r
## Lable missing station names as 'Unknown'
citi_data <- citi_data %>%
  mutate(
    start_station_name = ifelse(is.na(start_station_name), "Unknown", start_station_name),
    end_station_name = ifelse(is.na(end_station_name), "Unknown", end_station_name)
  )

## Check for missing data again
colSums(is.na(citi_data))
```

    ##            ride_id      rideable_type           weekdays           duration 
    ##                  0                  0                  0                  0 
    ## start_station_name   end_station_name      member_casual               year 
    ##                  0                  0                  0                  0 
    ##              month            dataset 
    ##                  0                  0

``` r
## Remove duplicate rows
citi_data <- citi_data %>%
  distinct()

## Check for and remove abnormal riding duration
citi_data <- citi_data %>%
  filter(duration >= 0) 

# rearrange the column sequence for readability
citi_data <- citi_data %>%
  select(
    ride_id, member_casual, rideable_type, year, month, weekdays, duration, start_station_name, end_station_name, dataset)

# Display the resulting dataset
glimpse(citi_data)
```

    ## Rows: 99,485
    ## Columns: 10
    ## $ ride_id            <chr> "4BE06CB33B037044", "26886E034974493B", "24DC56060E…
    ## $ member_casual      <chr> "member", "member", "member", "member", "member", "…
    ## $ rideable_type      <chr> "classic_bike", "classic_bike", "classic_bike", "cl…
    ## $ year               <dbl> 2020, 2020, 2020, 2020, 2020, 2020, 2020, 2020, 202…
    ## $ month              <chr> "January", "January", "January", "January", "Januar…
    ## $ weekdays           <chr> "Tuesday", "Wednesday", "Friday", "Sunday", "Friday…
    ## $ duration           <dbl> 15.333267, 5.309467, 9.691800, 6.996183, 2.849500, …
    ## $ start_station_name <chr> "Columbus Ave & W 95 St", "2 Ave & E 96 St", "Colum…
    ## $ end_station_name   <chr> "E 53 St & Madison Ave", "1 Ave & E 110 St", "Grand…
    ## $ dataset            <chr> "Jan_2020_Citi", "Jan_2020_Citi", "Jan_2020_Citi", …

### Description of the resulting dataset:

- This dataset contains information on Citi Bike rides taken in New York
  City during January and July of 2020 and 2024.
- The key columns (variables) include:
  - ride_id: Unique identifier for each ride.
  - member_casual: Rider type, either member or casual riders.
  - rideable_type: Type of bike, either classic_bike or electric_bike.
  - year: Year of the ride.
  - month: month of the ride.
  - weekdays: weekdays of the ride.
  - duration: Ride duration in minutes.
  - start_station_name: Starting stations name.
  - end_station_name: ending stations name.
  - dataset: Indicates the dataset source (e.g., Jan_2020_Citi).
- This dataset is prepared for analyzing ridership trends, user
  behavior, and ride patterns across various time periods and rider
  types.

## Step 2: Produce a reader-friendly table

``` r
# Summarize total rides by year, month, and rider type
summary_table <- citi_data %>% 
  group_by(year, month, member_casual) %>% 
  summarise(total_rides = n(), .groups = "drop")

# Pivot the table to have rider types as columns
pivoted_table <- summary_table %>% 
  pivot_wider(names_from = member_casual, values_from = total_rides, names_prefix = "Total_") %>% 
  mutate(Total_Rides = Total_member + Total_casual)  # Calculate sum of member and casual rides

# Create a reader-friendly table with gt()
pivoted_table %>% 
  gt() %>% 
  tab_header(title = "Total Number of Rides by Year, Month, and Rider Type", 
             subtitle = "Citi Bike Member vs Casual Riders") %>% 
  cols_label(
    year = "Year", 
    month = "Month", 
    Total_member = "Member Total Rides", 
    Total_casual = "Casual Total Rides",
    Total_Rides = "Total Rides"
  ) %>% 
   fmt_number(columns = c(Total_member, Total_casual, Total_Rides))%>% 
   tab_options(
    heading.align = "center"  # Center-align the title and subtitle
  )
```

<div id="aplsncsmsg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#aplsncsmsg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
&#10;#aplsncsmsg thead, #aplsncsmsg tbody, #aplsncsmsg tfoot, #aplsncsmsg tr, #aplsncsmsg td, #aplsncsmsg th {
  border-style: none;
}
&#10;#aplsncsmsg p {
  margin: 0;
  padding: 0;
}
&#10;#aplsncsmsg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}
&#10;#aplsncsmsg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}
&#10;#aplsncsmsg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}
&#10;#aplsncsmsg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}
&#10;#aplsncsmsg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}
&#10;#aplsncsmsg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}
&#10;#aplsncsmsg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}
&#10;#aplsncsmsg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}
&#10;#aplsncsmsg .gt_spanner_row {
  border-bottom-style: hidden;
}
&#10;#aplsncsmsg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}
&#10;#aplsncsmsg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}
&#10;#aplsncsmsg .gt_from_md > :first-child {
  margin-top: 0;
}
&#10;#aplsncsmsg .gt_from_md > :last-child {
  margin-bottom: 0;
}
&#10;#aplsncsmsg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}
&#10;#aplsncsmsg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#aplsncsmsg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}
&#10;#aplsncsmsg .gt_row_group_first td {
  border-top-width: 2px;
}
&#10;#aplsncsmsg .gt_row_group_first th {
  border-top-width: 2px;
}
&#10;#aplsncsmsg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#aplsncsmsg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_first_summary_row.thick {
  border-top-width: 2px;
}
&#10;#aplsncsmsg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#aplsncsmsg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}
&#10;#aplsncsmsg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#aplsncsmsg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#aplsncsmsg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#aplsncsmsg .gt_left {
  text-align: left;
}
&#10;#aplsncsmsg .gt_center {
  text-align: center;
}
&#10;#aplsncsmsg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}
&#10;#aplsncsmsg .gt_font_normal {
  font-weight: normal;
}
&#10;#aplsncsmsg .gt_font_bold {
  font-weight: bold;
}
&#10;#aplsncsmsg .gt_font_italic {
  font-style: italic;
}
&#10;#aplsncsmsg .gt_super {
  font-size: 65%;
}
&#10;#aplsncsmsg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}
&#10;#aplsncsmsg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}
&#10;#aplsncsmsg .gt_indent_1 {
  text-indent: 5px;
}
&#10;#aplsncsmsg .gt_indent_2 {
  text-indent: 10px;
}
&#10;#aplsncsmsg .gt_indent_3 {
  text-indent: 15px;
}
&#10;#aplsncsmsg .gt_indent_4 {
  text-indent: 20px;
}
&#10;#aplsncsmsg .gt_indent_5 {
  text-indent: 25px;
}
&#10;#aplsncsmsg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}
&#10;#aplsncsmsg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="5" class="gt_heading gt_title gt_font_normal" style>Total Number of Rides by Year, Month, and Rider Type</td>
    </tr>
    <tr class="gt_heading">
      <td colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Citi Bike Member vs Casual Riders</td>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="year">Year</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="month">Month</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total_casual">Casual Total Rides</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total_member">Member Total Rides</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Total_Rides">Total Rides</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="year" class="gt_row gt_right">2020</td>
<td headers="month" class="gt_row gt_left">January</td>
<td headers="Total_casual" class="gt_row gt_right">984.00</td>
<td headers="Total_member" class="gt_row gt_right">11,436.00</td>
<td headers="Total_Rides" class="gt_row gt_right">12,420.00</td></tr>
    <tr><td headers="year" class="gt_row gt_right">2020</td>
<td headers="month" class="gt_row gt_left">July</td>
<td headers="Total_casual" class="gt_row gt_right">5,637.00</td>
<td headers="Total_member" class="gt_row gt_right">15,411.00</td>
<td headers="Total_Rides" class="gt_row gt_right">21,048.00</td></tr>
    <tr><td headers="year" class="gt_row gt_right">2024</td>
<td headers="month" class="gt_row gt_left">January</td>
<td headers="Total_casual" class="gt_row gt_right">2,108.00</td>
<td headers="Total_member" class="gt_row gt_right">16,753.00</td>
<td headers="Total_Rides" class="gt_row gt_right">18,861.00</td></tr>
    <tr><td headers="year" class="gt_row gt_right">2024</td>
<td headers="month" class="gt_row gt_left">July</td>
<td headers="Total_casual" class="gt_row gt_right">10,894.00</td>
<td headers="Total_member" class="gt_row gt_right">36,262.00</td>
<td headers="Total_Rides" class="gt_row gt_right">47,156.00</td></tr>
  </tbody>
  &#10;  
</table>
</div>

### Comment on these results:

The table now features a ’Total Rides; column, making it easy to view
the combined ride totals for both members and casual riders across each
time period. This layout highlights overall ridership trends while still
offering a clear breakdown between the two rider types.

- Casual vs. Member Rides:  
  Members consistently take a higher number of rides compared to casual
  riders, which aligns with the understanding that members are frequent,
  regular users, while casual riders are typically occasional users or
  tourists.

- Seasonality:  
  There is a noticeable increase in rides in July compared to January
  for both years, which suggests seasonal usage patterns. This likely
  reflects the fact that summer months see higher ridership due to
  favorable weather.

- Year-over-Year Growth:  
  When comparing 2020 to 2024, we see an increase in the total number of
  rides in both January and July. This suggests overall growth in Citi
  Bike usage over the four-year period.

## Step 3: Create a table of the 5 most popular starting stations in July 2024.

### Find the 5 most popular starting stations

``` r
# Filter the data for July 2024
july_2024_data <- citi_data %>% 
  filter(year == 2024, month == "July")

# Find the 5 most popular starting stations
popular_stations <- july_2024_data %>% 
  group_by(start_station_name) %>%  # Group the data by start_station_name
  summarise(total_rides = n()) %>%  # Count the number of rides originating from each station
  arrange(desc(total_rides)) %>%  # Sort stations in descending order of the total number of rides
  slice_head(n = 5)  # Selects the top 5 starting stations

# Show the 5 most popular stations
cat("The 5 most popular starting stations are", 
    paste(popular_stations %>% pull(start_station_name), collapse = ", "), "\n")
```

    ## The 5 most popular starting stations are Pier 61 at Chelsea Piers, University Pl & E 14 St, W 21 St & 6 Ave, West St & Chambers St, W 31 St & 7 Ave

- The 5 most popular starting stations are:

1.  Pier 61 at Chelsea Piers,
2.  University Pl & E 14 St,
3.  W 21 St & 6 Ave
4.  West St & Chambers St
5.  W 31 St & 7 Ave

### Display this result in a table

``` r
popular_stations %>% 
  gt() %>% 
  tab_header(title = "Top 5 Starting Stations for July 2024",
             subtitle = "Based on Number of Rides"
) %>% 
  tab_options(
    heading.align = "center"  # Center-align the title and subtitle
  )
```

<div id="lkypyojhlq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lkypyojhlq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}
&#10;#lkypyojhlq thead, #lkypyojhlq tbody, #lkypyojhlq tfoot, #lkypyojhlq tr, #lkypyojhlq td, #lkypyojhlq th {
  border-style: none;
}
&#10;#lkypyojhlq p {
  margin: 0;
  padding: 0;
}
&#10;#lkypyojhlq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}
&#10;#lkypyojhlq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}
&#10;#lkypyojhlq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}
&#10;#lkypyojhlq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}
&#10;#lkypyojhlq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}
&#10;#lkypyojhlq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}
&#10;#lkypyojhlq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}
&#10;#lkypyojhlq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}
&#10;#lkypyojhlq .gt_spanner_row {
  border-bottom-style: hidden;
}
&#10;#lkypyojhlq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}
&#10;#lkypyojhlq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}
&#10;#lkypyojhlq .gt_from_md > :first-child {
  margin-top: 0;
}
&#10;#lkypyojhlq .gt_from_md > :last-child {
  margin-bottom: 0;
}
&#10;#lkypyojhlq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}
&#10;#lkypyojhlq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#lkypyojhlq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}
&#10;#lkypyojhlq .gt_row_group_first td {
  border-top-width: 2px;
}
&#10;#lkypyojhlq .gt_row_group_first th {
  border-top-width: 2px;
}
&#10;#lkypyojhlq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#lkypyojhlq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_first_summary_row.thick {
  border-top-width: 2px;
}
&#10;#lkypyojhlq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#lkypyojhlq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}
&#10;#lkypyojhlq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#lkypyojhlq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}
&#10;#lkypyojhlq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}
&#10;#lkypyojhlq .gt_left {
  text-align: left;
}
&#10;#lkypyojhlq .gt_center {
  text-align: center;
}
&#10;#lkypyojhlq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}
&#10;#lkypyojhlq .gt_font_normal {
  font-weight: normal;
}
&#10;#lkypyojhlq .gt_font_bold {
  font-weight: bold;
}
&#10;#lkypyojhlq .gt_font_italic {
  font-style: italic;
}
&#10;#lkypyojhlq .gt_super {
  font-size: 65%;
}
&#10;#lkypyojhlq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}
&#10;#lkypyojhlq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}
&#10;#lkypyojhlq .gt_indent_1 {
  text-indent: 5px;
}
&#10;#lkypyojhlq .gt_indent_2 {
  text-indent: 10px;
}
&#10;#lkypyojhlq .gt_indent_3 {
  text-indent: 15px;
}
&#10;#lkypyojhlq .gt_indent_4 {
  text-indent: 20px;
}
&#10;#lkypyojhlq .gt_indent_5 {
  text-indent: 25px;
}
&#10;#lkypyojhlq .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}
&#10;#lkypyojhlq div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
  <thead>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_title gt_font_normal" style>Top 5 Starting Stations for July 2024</td>
    </tr>
    <tr class="gt_heading">
      <td colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style>Based on Number of Rides</td>
    </tr>
    <tr class="gt_col_headings">
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="start_station_name">start_station_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="total_rides">total_rides</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="start_station_name" class="gt_row gt_left">Pier 61 at Chelsea Piers</td>
<td headers="total_rides" class="gt_row gt_right">163</td></tr>
    <tr><td headers="start_station_name" class="gt_row gt_left">University Pl &amp; E 14 St</td>
<td headers="total_rides" class="gt_row gt_right">155</td></tr>
    <tr><td headers="start_station_name" class="gt_row gt_left">W 21 St &amp; 6 Ave</td>
<td headers="total_rides" class="gt_row gt_right">152</td></tr>
    <tr><td headers="start_station_name" class="gt_row gt_left">West St &amp; Chambers St</td>
<td headers="total_rides" class="gt_row gt_right">150</td></tr>
    <tr><td headers="start_station_name" class="gt_row gt_left">W 31 St &amp; 7 Ave</td>
<td headers="total_rides" class="gt_row gt_right">146</td></tr>
  </tbody>
  &#10;  
</table>
</div>

### Comment on this table:

- Most of the top stations are located in busy, popular areas of
  Manhattan, serving as hubs for both commuters and tourists.

- The small difference in ride numbers between stations shows that all
  are heavily used.

- Chelsea Piers stands out as a major attraction, making it the most
  popular station.

## Step 4: Make a plot to investigate the effects of day of the week, month, and year on median ride duration.

### Calculate median ride duration and explore the influential factors

``` r
# Calculate the median ride duration for each combination of year, month, and weekday
median_duration_data <- citi_data %>% 
  group_by(year, month, weekdays) %>% 
  summarise(median_duration = median(duration), .groups = "drop") %>% 
  mutate(year = as.factor(year), 
         weekdays = factor(
           weekdays, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")))

# Create a multi-panel plot to show the influence from these factors on the median ride duration.
ggplot(median_duration_data, aes(x = weekdays, y = median_duration, fill = factor(year))) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.8) +  # Side-by-side bars (dodge)
  geom_line(aes(group = year, color = factor(year)), size = 1.0, position = position_dodge(width = 0.9)) +  # Add line trend on top of bars
  facet_wrap(~ month, ncol = 2) +  # Create two panels for January and July
  labs(title = "Comparison of Median Ride Duration in January and July (2020 vs 2024)",
       x = "Day of the Week",
       y = "Median Ride Duration (minutes)",
       fill = "Year", color = "Year") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5,size=15) 
  )
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-21-1.png" width="90%" />

### Comment on the observations from this plot:

- Seasonal Differences: July has longer median ride durations than
  January, likely due to favorable summer weather encouraging extended
  rides.

- Weekday vs. Weekend: Ride durations are notably higher on weekends
  (Saturday and Sunday) compared to weekdays, indicating longer,
  possibly more leisurely rides on weekends.

- Comparison between 2020 and 2024: In January, the median ride
  durations are quite similar for both years. However, in July, rides
  were longer in 2020, particularly on weekends, which could point to
  changes in rider behavior influenced by external factors.

Conclusion: The data highlights clear seasonal and weekly patterns, with
longer rides in July and over the weekends, especially in 2020 compared
to 2024.

## Step 5: Make a figure that shows the impact of month, membership status, and bike type on the distribution of ride duration for data in 2024.

``` r
# Select only the 2024 data
citi_data_2024 <- citi_data %>%
  filter(year == 2024)  # Filtering for the year 2024

# Generate the box plot to analyze the effects of month, membership type, and bike type
ggplot(citi_data_2024, aes(x = rideable_type, y = duration, fill = member_casual)) +
  geom_boxplot(alpha = 0.7, outlier.size = 1.2) +  # Display the box plot to show distribution
  facet_wrap(~ month, scales = "free", ncol = 2) +  # Split the plot by month
  labs(title = "Impact of Month, Membership Type, and Bike Type on Ride Duration (2024)",
       x = "Type of Bike",
       y = "Ride Duration (minutes)",
       fill = "Rider Type") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), # Tilt the x-axis labels for readability
        plot.title = element_text(hjust = 0.5, size=15)
  )
```

<img src="p8105_hw3_jz3900_files/figure-gfm/unnamed-chunk-22-1.png" width="90%" />

### Comment on the results:

- Effect of Bike Type:  
  Electric bikes generally result in shorter ride times compared to
  classic bikes, which is expected since electric bikes allow for faster
  travel. This pattern holds true for both January and July. Casual
  riders, especially in July, tend to have slightly longer rides on
  electric bikes compared to members.

- Seasonal Influence:  
  In July, ride durations vary more widely than in January, likely
  because the warmer weather encourages longer, leisure-based rides. In
  contrast, January sees shorter rides, likely due to the colder
  temperatures limiting outdoor activity.

- Membership Trends:  
  Casual riders generally have longer ride durations than members,
  regardless of bike type, with the difference being especially
  pronounced for classic bikes. This suggests that casual users may be
  taking longer, more recreational trips, while members focus on
  shorter, more practical rides.

- Ride Duration Patterns:  
  The data shows more outliers (very long rides) among casual riders on
  classic bikes, especially in July. This suggests that some casual
  riders take much longer trips during the summer months.

Summary:  
Electric bikes lead to quicker, shorter rides, particularly for members,
while casual riders tend to take longer rides, especially on classic
bikes, with longer trips being more frequent during the summer month.
